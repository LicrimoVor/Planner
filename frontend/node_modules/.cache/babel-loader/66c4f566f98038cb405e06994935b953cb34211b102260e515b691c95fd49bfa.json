{"ast":null,"code":"import { UserService } from \"@entities/user\";\nimport { create } from \"zustand\";\nimport { sessionStore } from \"@entities/session\";\nimport Cookies from \"js-cookie\";\nimport { ResponseErrorHandler } from \"@shared/api\";\nclass UserStore {\n  constructor() {\n    this.store = void 0;\n    this.useProfile = () => this.store(state => state.profile);\n    this.getMe = () => this.store.getState().getMe();\n    this.update = profile => this.store.getState().update(profile);\n    this.store = create((set, get) => ({\n      profile: null,\n      getMe: async () => {\n        set({\n          profile: null\n        });\n        try {\n          const response = await UserService.getMe();\n          // await new Promise(resolve => setTimeout(resolve, 5000));\n          sessionStore.setUser(Cookies.get(\"sessionid\"));\n          set({\n            profile: response\n          });\n        } catch (error) {\n          var _response;\n          if ((error === null || error === void 0 ? void 0 : (_response = error.response) === null || _response === void 0 ? void 0 : _response.status) === 401) {\n            sessionStore.removeUser();\n          }\n        }\n      },\n      update: async profile => {\n        try {\n          const response = await UserService.update(profile);\n          set({\n            profile: response\n          });\n        } catch (error) {}\n      },\n      setPassword: async passwordDto => {\n        try {\n          await UserService.setPassword(passwordDto);\n        } catch (error) {\n          throw new ResponseErrorHandler(error);\n        }\n      }\n    }));\n  }\n}\nexport const userStore = new UserStore();","map":{"version":3,"names":["UserService","create","sessionStore","Cookies","ResponseErrorHandler","UserStore","constructor","store","useProfile","state","profile","getMe","getState","update","set","get","response","setUser","error","_response","status","removeUser","setPassword","passwordDto","userStore"],"sources":["D:/Mega/Planner/frontend/src/entities/user/store.ts"],"sourcesContent":["import {IProfile, IUser, UserPasswordDto, UserService, UserUpdateDto} from \"@entities/user\";\r\nimport {create} from \"zustand\";\r\nimport {AxiosError} from \"axios\";\r\nimport {sessionStore} from \"@entities/session\";\r\nimport Cookies from \"js-cookie\";\r\nimport {ResponseErrorData, ResponseErrorHandler} from \"@shared/api\";\r\n\r\ninterface UserState {\r\n    profile: IProfile | null;\r\n\r\n    getMe: () => Promise<void>;\r\n    update: (profile: UserUpdateDto) => Promise<void>;\r\n    setPassword: (passwordDto: UserPasswordDto) => Promise<void>;\r\n}\r\n\r\nclass UserStore {\r\n    private readonly store;\r\n\r\n    constructor() {\r\n        this.store = create<UserState>((set, get) => ({\r\n            profile: null,\r\n\r\n            getMe: async () => {\r\n                set({profile: null});\r\n\r\n                try {\r\n                    const response = await UserService.getMe();\r\n                    // await new Promise(resolve => setTimeout(resolve, 5000));\r\n                    sessionStore.setUser(Cookies.get(\"sessionid\")!);\r\n                    set({profile: response});\r\n                }\r\n                catch (error) {\r\n                    if((error as AxiosError)?.response?.status === 401) {\r\n                        sessionStore.removeUser();\r\n                    }\r\n                }\r\n            },\r\n\r\n            update: async (profile: UserUpdateDto) => {\r\n                try {\r\n                    const response = await UserService.update(profile);\r\n\r\n                    set({profile: response});\r\n                }\r\n                catch (error) {\r\n\r\n                }\r\n            },\r\n\r\n            setPassword: async(passwordDto: UserPasswordDto) => {\r\n                try {\r\n                    await UserService.setPassword(passwordDto);\r\n                }\r\n                catch (error) {\r\n                    throw new ResponseErrorHandler(error as ResponseErrorData);\r\n                }\r\n            }\r\n        }));\r\n    }\r\n\r\n    useProfile = () => this.store(state => state.profile);\r\n\r\n    getMe = () => this.store.getState().getMe();\r\n    update = (profile: UserUpdateDto) => this.store.getState().update(profile);\r\n}\r\n\r\nexport const userStore = new UserStore();"],"mappings":"AAAA,SAA0CA,WAAW,QAAsB,gBAAgB;AAC3F,SAAQC,MAAM,QAAO,SAAS;AAE9B,SAAQC,YAAY,QAAO,mBAAmB;AAC9C,OAAOC,OAAO,MAAM,WAAW;AAC/B,SAA2BC,oBAAoB,QAAO,aAAa;AAUnE,MAAMC,SAAS,CAAC;EAGZC,WAAWA,CAAA,EAAG;IAAA,KAFGC,KAAK;IAAA,KA4CtBC,UAAU,GAAG,MAAM,IAAI,CAACD,KAAK,CAACE,KAAK,IAAIA,KAAK,CAACC,OAAO,CAAC;IAAA,KAErDC,KAAK,GAAG,MAAM,IAAI,CAACJ,KAAK,CAACK,QAAQ,CAAC,CAAC,CAACD,KAAK,CAAC,CAAC;IAAA,KAC3CE,MAAM,GAAIH,OAAsB,IAAK,IAAI,CAACH,KAAK,CAACK,QAAQ,CAAC,CAAC,CAACC,MAAM,CAACH,OAAO,CAAC;IA5CtE,IAAI,CAACH,KAAK,GAAGN,MAAM,CAAY,CAACa,GAAG,EAAEC,GAAG,MAAM;MAC1CL,OAAO,EAAE,IAAI;MAEbC,KAAK,EAAE,MAAAA,CAAA,KAAY;QACfG,GAAG,CAAC;UAACJ,OAAO,EAAE;QAAI,CAAC,CAAC;QAEpB,IAAI;UACA,MAAMM,QAAQ,GAAG,MAAMhB,WAAW,CAACW,KAAK,CAAC,CAAC;UAC1C;UACAT,YAAY,CAACe,OAAO,CAACd,OAAO,CAACY,GAAG,CAAC,WAAW,CAAE,CAAC;UAC/CD,GAAG,CAAC;YAACJ,OAAO,EAAEM;UAAQ,CAAC,CAAC;QAC5B,CAAC,CACD,OAAOE,KAAK,EAAE;UAAA,IAAAC,SAAA;UACV,IAAG,CAACD,KAAK,aAALA,KAAK,wBAAAC,SAAA,GAALD,KAAK,CAAiBF,QAAQ,cAAAG,SAAA,uBAA/BA,SAAA,CAAiCC,MAAM,MAAK,GAAG,EAAE;YAChDlB,YAAY,CAACmB,UAAU,CAAC,CAAC;UAC7B;QACJ;MACJ,CAAC;MAEDR,MAAM,EAAE,MAAOH,OAAsB,IAAK;QACtC,IAAI;UACA,MAAMM,QAAQ,GAAG,MAAMhB,WAAW,CAACa,MAAM,CAACH,OAAO,CAAC;UAElDI,GAAG,CAAC;YAACJ,OAAO,EAAEM;UAAQ,CAAC,CAAC;QAC5B,CAAC,CACD,OAAOE,KAAK,EAAE,CAEd;MACJ,CAAC;MAEDI,WAAW,EAAE,MAAMC,WAA4B,IAAK;QAChD,IAAI;UACA,MAAMvB,WAAW,CAACsB,WAAW,CAACC,WAAW,CAAC;QAC9C,CAAC,CACD,OAAOL,KAAK,EAAE;UACV,MAAM,IAAId,oBAAoB,CAACc,KAA0B,CAAC;QAC9D;MACJ;IACJ,CAAC,CAAC,CAAC;EACP;AAMJ;AAEA,OAAO,MAAMM,SAAS,GAAG,IAAInB,SAAS,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}