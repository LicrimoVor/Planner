{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport { ResponseErrorHandler } from \"@shared/api\";\nexport function useForm(props) {\n  _s();\n  const {\n    fields,\n    apiCall,\n    onSuccess,\n    onFailure,\n    defaultError,\n    defaultSuccessMessage\n  } = props;\n  const [isSending, setIsSending] = useState(false);\n  const [sendingError, setSendingError] = useState(defaultError);\n  const [successMessage, setSuccessMessage] = useState(\"\");\n  const handleFormSubmit = async event => {\n    event.preventDefault();\n    const errors = await Promise.all(fields.map(field => field.hasError()));\n    const isFormValid = errors.every(error => !error);\n    if (!isFormValid) return;\n    setIsSending(true);\n    setSendingError(defaultError);\n    setSuccessMessage(\"\");\n    try {\n      const response = await apiCall();\n      !!defaultSuccessMessage && setSuccessMessage(defaultSuccessMessage);\n      onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(response);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : error instanceof ResponseErrorHandler ? error.data : \"Произошла ошибка при выполнении запроса\";\n      if (error instanceof ResponseErrorHandler) {\n        fields.forEach(field => {\n          field.setFieldError(message[field.id] || null);\n        });\n      }\n      setSendingError(message);\n      onFailure === null || onFailure === void 0 ? void 0 : onFailure(message);\n    } finally {\n      setIsSending(false);\n    }\n  };\n  const hasFieldErrors = fields.some(field => !!field.error);\n  return {\n    isSending,\n    sendingError,\n    successMessage,\n    hasFieldErrors,\n    handleFormSubmit\n  };\n}\n_s(useForm, \"Gj9xnpMPoR/MujrKKKfTvZmp/Mc=\");\n;","map":{"version":3,"names":["useState","ResponseErrorHandler","useForm","props","_s","fields","apiCall","onSuccess","onFailure","defaultError","defaultSuccessMessage","isSending","setIsSending","sendingError","setSendingError","successMessage","setSuccessMessage","handleFormSubmit","event","preventDefault","errors","Promise","all","map","field","hasError","isFormValid","every","error","response","message","Error","data","forEach","setFieldError","id","hasFieldErrors","some"],"sources":["D:/Mega/Planner/frontend/src/shared/hooks/form/use-form.ts"],"sourcesContent":["import {DefaultField} from \"@shared/types\";\r\nimport {FormEventHandler, useState} from \"react\";\r\nimport {ResponseErrorHandler, ResponseErrorData} from \"@shared/api\";\r\n\r\nexport function useForm<Field extends DefaultField, Response, ResponseError>(props: {\r\n    fields: Field[];\r\n    apiCall: () => Promise<Response>;\r\n    onSuccess?: (response: Response) => void;\r\n    onFailure?: (error: ResponseError) => void;\r\n    defaultError: ResponseError;\r\n    defaultSuccessMessage?: string;\r\n}): {\r\n    isSending: boolean;\r\n    sendingError: ResponseError;\r\n    successMessage: string;\r\n    hasFieldErrors: boolean;\r\n    handleFormSubmit: FormEventHandler<HTMLFormElement>;\r\n} {\r\n    const {fields, apiCall, onSuccess, onFailure, defaultError, defaultSuccessMessage} = props;\r\n\r\n    const [isSending, setIsSending] = useState(false);\r\n    const [sendingError, setSendingError] = useState<ResponseError>(defaultError);\r\n    const [successMessage, setSuccessMessage] = useState(\"\");\r\n\r\n    const handleFormSubmit: FormEventHandler<HTMLFormElement> = async (event) => {\r\n        event.preventDefault();\r\n\r\n        const errors = await Promise.all(fields.map(field => field.hasError()));\r\n        const isFormValid = errors.every(error => !error);\r\n\r\n        if(!isFormValid) return;\r\n\r\n        setIsSending(true);\r\n        setSendingError(defaultError);\r\n        setSuccessMessage(\"\");\r\n\r\n        try {\r\n            const response = await apiCall();\r\n            !!defaultSuccessMessage && (setSuccessMessage(defaultSuccessMessage));\r\n            onSuccess?.(response);\r\n        }\r\n        catch (error) {\r\n            const message = (\r\n                error instanceof Error ?\r\n                    error.message :\r\n                error instanceof ResponseErrorHandler ?\r\n                    error.data :\r\n                \"Произошла ошибка при выполнении запроса\"\r\n            ) as ResponseError;\r\n\r\n            if(error instanceof ResponseErrorHandler) {\r\n                fields.forEach(field => {\r\n                    field.setFieldError((message as ResponseErrorData)[field.id] || null);\r\n                });\r\n            }\r\n\r\n            setSendingError(message);\r\n            onFailure?.(message);\r\n        }\r\n        finally {\r\n            setIsSending(false);\r\n        }\r\n    };\r\n\r\n    const hasFieldErrors = fields.some(field => !!field.error);\r\n\r\n    return {\r\n        isSending,\r\n        sendingError,\r\n        successMessage,\r\n        hasFieldErrors,\r\n        handleFormSubmit\r\n    };\r\n};"],"mappings":";AACA,SAA0BA,QAAQ,QAAO,OAAO;AAChD,SAAQC,oBAAoB,QAA0B,aAAa;AAEnE,OAAO,SAASC,OAAOA,CAAsDC,KAO5E,EAMC;EAAAC,EAAA;EACE,MAAM;IAACC,MAAM;IAAEC,OAAO;IAAEC,SAAS;IAAEC,SAAS;IAAEC,YAAY;IAAEC;EAAqB,CAAC,GAAGP,KAAK;EAE1F,MAAM,CAACQ,SAAS,EAAEC,YAAY,CAAC,GAAGZ,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAM,CAACa,YAAY,EAAEC,eAAe,CAAC,GAAGd,QAAQ,CAAgBS,YAAY,CAAC;EAC7E,MAAM,CAACM,cAAc,EAAEC,iBAAiB,CAAC,GAAGhB,QAAQ,CAAC,EAAE,CAAC;EAExD,MAAMiB,gBAAmD,GAAG,MAAOC,KAAK,IAAK;IACzEA,KAAK,CAACC,cAAc,CAAC,CAAC;IAEtB,MAAMC,MAAM,GAAG,MAAMC,OAAO,CAACC,GAAG,CAACjB,MAAM,CAACkB,GAAG,CAACC,KAAK,IAAIA,KAAK,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACvE,MAAMC,WAAW,GAAGN,MAAM,CAACO,KAAK,CAACC,KAAK,IAAI,CAACA,KAAK,CAAC;IAEjD,IAAG,CAACF,WAAW,EAAE;IAEjBd,YAAY,CAAC,IAAI,CAAC;IAClBE,eAAe,CAACL,YAAY,CAAC;IAC7BO,iBAAiB,CAAC,EAAE,CAAC;IAErB,IAAI;MACA,MAAMa,QAAQ,GAAG,MAAMvB,OAAO,CAAC,CAAC;MAChC,CAAC,CAACI,qBAAqB,IAAKM,iBAAiB,CAACN,qBAAqB,CAAE;MACrEH,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAGsB,QAAQ,CAAC;IACzB,CAAC,CACD,OAAOD,KAAK,EAAE;MACV,MAAME,OAAO,GACTF,KAAK,YAAYG,KAAK,GAClBH,KAAK,CAACE,OAAO,GACjBF,KAAK,YAAY3B,oBAAoB,GACjC2B,KAAK,CAACI,IAAI,GACd,yCACc;MAElB,IAAGJ,KAAK,YAAY3B,oBAAoB,EAAE;QACtCI,MAAM,CAAC4B,OAAO,CAACT,KAAK,IAAI;UACpBA,KAAK,CAACU,aAAa,CAAEJ,OAAO,CAAuBN,KAAK,CAACW,EAAE,CAAC,IAAI,IAAI,CAAC;QACzE,CAAC,CAAC;MACN;MAEArB,eAAe,CAACgB,OAAO,CAAC;MACxBtB,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAGsB,OAAO,CAAC;IACxB,CAAC,SACO;MACJlB,YAAY,CAAC,KAAK,CAAC;IACvB;EACJ,CAAC;EAED,MAAMwB,cAAc,GAAG/B,MAAM,CAACgC,IAAI,CAACb,KAAK,IAAI,CAAC,CAACA,KAAK,CAACI,KAAK,CAAC;EAE1D,OAAO;IACHjB,SAAS;IACTE,YAAY;IACZE,cAAc;IACdqB,cAAc;IACdnB;EACJ,CAAC;AACL;AAACb,EAAA,CArEeF,OAAO;AAqEtB"},"metadata":{},"sourceType":"module","externalDependencies":[]}