{"ast":null,"code":"var _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { create } from \"zustand\";\nimport { API_META } from \"@shared/api\";\nimport { AuthService, UserStore } from \"@entities/user\";\nconst useAuthStore = create((set, get) => ({\n  meta: API_META.INITIAL,\n  isAuth: false,\n  login: async params => {\n    if (get().meta === API_META.LOADING) {\n      return;\n    }\n    set({\n      meta: API_META.LOADING\n    });\n    try {\n      const response = await AuthService.login(params);\n      localStorage.setItem(\"token\", response.csrfToken);\n      set({\n        isAuth: true,\n        meta: API_META.SUCCESS\n      });\n    } catch (error) {\n      set({\n        meta: API_META.ERROR\n      });\n    }\n  },\n  logout: async () => {\n    if (get().meta === API_META.LOADING) {\n      return;\n    }\n    set({\n      meta: API_META.LOADING\n    });\n    try {\n      await AuthService.logout();\n      localStorage.removeItem(\"token\");\n      set({\n        isAuth: false,\n        meta: API_META.SUCCESS\n      });\n    } catch (error) {\n      set({\n        meta: API_META.ERROR\n      });\n    }\n  },\n  check: async () => {\n    if (get().meta === API_META.LOADING) {\n      return;\n    }\n    set({\n      meta: API_META.LOADING\n    });\n    if (!localStorage.getItem(\"token\")) {\n      set({\n        isAuth: false,\n        meta: API_META.ERROR\n      });\n      return;\n    }\n    try {\n      await UserStore.getMe();\n      set({\n        isAuth: true,\n        meta: API_META.SUCCESS\n      });\n    } catch {\n      set({\n        isAuth: false,\n        meta: API_META.ERROR\n      });\n    }\n  }\n}));\nexport class AuthStore {}\nAuthStore.useMeta = _s(() => {\n  _s();\n  return useAuthStore(state => state.meta);\n}, \"BSK3XewfuZPixDP8tbzcobpulFc=\", false, function () {\n  return [useAuthStore];\n});\nAuthStore.useAuth = _s2(() => {\n  _s2();\n  return useAuthStore(state => state.isAuth);\n}, \"BSK3XewfuZPixDP8tbzcobpulFc=\", false, function () {\n  return [useAuthStore];\n});\nAuthStore.login = useAuthStore.getState().login;\nAuthStore.logout = useAuthStore.getState().logout;\nAuthStore.check = useAuthStore.getState().check;","map":{"version":3,"names":["create","API_META","AuthService","UserStore","useAuthStore","set","get","meta","INITIAL","isAuth","login","params","LOADING","response","localStorage","setItem","csrfToken","SUCCESS","error","ERROR","logout","removeItem","check","getItem","getMe","AuthStore","useMeta","_s","state","useAuth","_s2","getState"],"sources":["D:/Mega/Planner/frontend/src/entities/user/auth/store.ts"],"sourcesContent":["import {create} from \"zustand\";\r\nimport {API_META} from \"@shared/api\";\r\nimport {AuthService, ILoginParams, UserStore} from \"@entities/user\";\r\n\r\n\r\ninterface AuthState {\r\n    meta: API_META;\r\n    isAuth: boolean;\r\n\r\n    login: (params: ILoginParams) => Promise<void>;\r\n    logout: () => Promise<void>;\r\n    check: () => Promise<void>;\r\n}\r\n\r\nconst useAuthStore = create<AuthState>((set, get) => ({\r\n    meta: API_META.INITIAL,\r\n    isAuth: false,\r\n\r\n    login: async (params) => {\r\n        if(get().meta === API_META.LOADING) {\r\n            return;\r\n        }\r\n\r\n        set({meta: API_META.LOADING});\r\n\r\n        try {\r\n            const response = await AuthService.login(params);\r\n            localStorage.setItem(\"token\", response.csrfToken);\r\n            set({isAuth: true, meta: API_META.SUCCESS});\r\n        }\r\n        catch (error) {\r\n            set({meta: API_META.ERROR});\r\n        }\r\n    },\r\n\r\n    logout: async () => {\r\n        if(get().meta === API_META.LOADING) {\r\n            return;\r\n        }\r\n\r\n        set({meta: API_META.LOADING});\r\n\r\n        try {\r\n            await AuthService.logout();\r\n            localStorage.removeItem(\"token\");\r\n            set({isAuth: false, meta: API_META.SUCCESS});\r\n        }\r\n        catch (error) {\r\n            set({meta: API_META.ERROR});\r\n        }\r\n    },\r\n\r\n    check: async () => {\r\n        if(get().meta === API_META.LOADING) {\r\n            return;\r\n        }\r\n\r\n        set({meta: API_META.LOADING});\r\n\r\n        if(!localStorage.getItem(\"token\")) {\r\n            set({isAuth: false, meta: API_META.ERROR});\r\n            return;\r\n        }\r\n\r\n        try {\r\n            await UserStore.getMe();\r\n            set({isAuth: true, meta: API_META.SUCCESS});\r\n        }\r\n        catch {\r\n            set({isAuth: false, meta: API_META.ERROR});\r\n        }\r\n    }\r\n}));\r\n\r\nexport class AuthStore {\r\n    static useMeta = () => useAuthStore(state => state.meta);\r\n    static useAuth = () => useAuthStore(state => state.isAuth);\r\n\r\n    static login = useAuthStore.getState().login;\r\n    static logout = useAuthStore.getState().logout;\r\n    static check = useAuthStore.getState().check;\r\n}"],"mappings":";;AAAA,SAAQA,MAAM,QAAO,SAAS;AAC9B,SAAQC,QAAQ,QAAO,aAAa;AACpC,SAAQC,WAAW,EAAgBC,SAAS,QAAO,gBAAgB;AAYnE,MAAMC,YAAY,GAAGJ,MAAM,CAAY,CAACK,GAAG,EAAEC,GAAG,MAAM;EAClDC,IAAI,EAAEN,QAAQ,CAACO,OAAO;EACtBC,MAAM,EAAE,KAAK;EAEbC,KAAK,EAAE,MAAOC,MAAM,IAAK;IACrB,IAAGL,GAAG,CAAC,CAAC,CAACC,IAAI,KAAKN,QAAQ,CAACW,OAAO,EAAE;MAChC;IACJ;IAEAP,GAAG,CAAC;MAACE,IAAI,EAAEN,QAAQ,CAACW;IAAO,CAAC,CAAC;IAE7B,IAAI;MACA,MAAMC,QAAQ,GAAG,MAAMX,WAAW,CAACQ,KAAK,CAACC,MAAM,CAAC;MAChDG,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEF,QAAQ,CAACG,SAAS,CAAC;MACjDX,GAAG,CAAC;QAACI,MAAM,EAAE,IAAI;QAAEF,IAAI,EAAEN,QAAQ,CAACgB;MAAO,CAAC,CAAC;IAC/C,CAAC,CACD,OAAOC,KAAK,EAAE;MACVb,GAAG,CAAC;QAACE,IAAI,EAAEN,QAAQ,CAACkB;MAAK,CAAC,CAAC;IAC/B;EACJ,CAAC;EAEDC,MAAM,EAAE,MAAAA,CAAA,KAAY;IAChB,IAAGd,GAAG,CAAC,CAAC,CAACC,IAAI,KAAKN,QAAQ,CAACW,OAAO,EAAE;MAChC;IACJ;IAEAP,GAAG,CAAC;MAACE,IAAI,EAAEN,QAAQ,CAACW;IAAO,CAAC,CAAC;IAE7B,IAAI;MACA,MAAMV,WAAW,CAACkB,MAAM,CAAC,CAAC;MAC1BN,YAAY,CAACO,UAAU,CAAC,OAAO,CAAC;MAChChB,GAAG,CAAC;QAACI,MAAM,EAAE,KAAK;QAAEF,IAAI,EAAEN,QAAQ,CAACgB;MAAO,CAAC,CAAC;IAChD,CAAC,CACD,OAAOC,KAAK,EAAE;MACVb,GAAG,CAAC;QAACE,IAAI,EAAEN,QAAQ,CAACkB;MAAK,CAAC,CAAC;IAC/B;EACJ,CAAC;EAEDG,KAAK,EAAE,MAAAA,CAAA,KAAY;IACf,IAAGhB,GAAG,CAAC,CAAC,CAACC,IAAI,KAAKN,QAAQ,CAACW,OAAO,EAAE;MAChC;IACJ;IAEAP,GAAG,CAAC;MAACE,IAAI,EAAEN,QAAQ,CAACW;IAAO,CAAC,CAAC;IAE7B,IAAG,CAACE,YAAY,CAACS,OAAO,CAAC,OAAO,CAAC,EAAE;MAC/BlB,GAAG,CAAC;QAACI,MAAM,EAAE,KAAK;QAAEF,IAAI,EAAEN,QAAQ,CAACkB;MAAK,CAAC,CAAC;MAC1C;IACJ;IAEA,IAAI;MACA,MAAMhB,SAAS,CAACqB,KAAK,CAAC,CAAC;MACvBnB,GAAG,CAAC;QAACI,MAAM,EAAE,IAAI;QAAEF,IAAI,EAAEN,QAAQ,CAACgB;MAAO,CAAC,CAAC;IAC/C,CAAC,CACD,MAAM;MACFZ,GAAG,CAAC;QAACI,MAAM,EAAE,KAAK;QAAEF,IAAI,EAAEN,QAAQ,CAACkB;MAAK,CAAC,CAAC;IAC9C;EACJ;AACJ,CAAC,CAAC,CAAC;AAEH,OAAO,MAAMM,SAAS,CAAC;AAAVA,SAAS,CACXC,OAAO,GAAAC,EAAA,CAAG;EAAAA,EAAA;EAAA,OAAMvB,YAAY,CAACwB,KAAK,IAAIA,KAAK,CAACrB,IAAI,CAAC;AAAA;EAAA,QAAjCH,YAAY;AAAA;AAD1BqB,SAAS,CAEXI,OAAO,GAAAC,GAAA,CAAG;EAAAA,GAAA;EAAA,OAAM1B,YAAY,CAACwB,KAAK,IAAIA,KAAK,CAACnB,MAAM,CAAC;AAAA;EAAA,QAAnCL,YAAY;AAAA;AAF1BqB,SAAS,CAIXf,KAAK,GAAGN,YAAY,CAAC2B,QAAQ,CAAC,CAAC,CAACrB,KAAK;AAJnCe,SAAS,CAKXL,MAAM,GAAGhB,YAAY,CAAC2B,QAAQ,CAAC,CAAC,CAACX,MAAM;AALrCK,SAAS,CAMXH,KAAK,GAAGlB,YAAY,CAAC2B,QAAQ,CAAC,CAAC,CAACT,KAAK"},"metadata":{},"sourceType":"module","externalDependencies":[]}