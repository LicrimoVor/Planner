{"ast":null,"code":"import { UserService } from \"@entities/user\";\nimport { create } from \"zustand\";\nimport { sessionStore } from \"@entities/session\";\nimport Cookies from \"js-cookie\";\nimport { apiInstance, ResponseErrorHandler } from \"@shared/api\";\nclass UserStore {\n  constructor() {\n    this.store = void 0;\n    this.useProfile = () => this.store(state => state.profile);\n    this.getMe = () => this.store.getState().getMe();\n    this.update = profile => this.store.getState().update(profile);\n    this.setPassword = passwordDto => this.store.getState().setPassword(passwordDto);\n    this.getAvatar = () => this.store.getState().getAvatar();\n    this.store = create((set, get) => ({\n      profile: null,\n      getMe: async () => {\n        set({\n          profile: null\n        });\n        try {\n          const response = await UserService.getMe();\n          await new Promise(resolve => setTimeout(resolve, 500));\n          sessionStore.setUser(Cookies.get(\"sessionid\"));\n          set({\n            profile: response\n          });\n        } catch (error) {\n          if ((error === null || error === void 0 ? void 0 : error.status) === 401) {\n            sessionStore.removeUser();\n          }\n        }\n      },\n      update: async profile => {\n        try {\n          const response = await UserService.update(profile);\n          set({\n            profile: response\n          });\n        } catch (error) {\n          throw new ResponseErrorHandler(error);\n        }\n      },\n      setPassword: async passwordDto => {\n        try {\n          await UserService.setPassword(passwordDto);\n          sessionStore.removeUser();\n        } catch (error) {\n          throw new ResponseErrorHandler(error);\n        }\n      },\n      getAvatar: () => {\n        var _get$profile;\n        if (!((_get$profile = get().profile) !== null && _get$profile !== void 0 && _get$profile.avatar)) {\n          return null;\n        }\n        return apiInstance.getMedia(get().profile.avatar);\n      }\n    }));\n  }\n}\nexport const userStore = new UserStore();","map":{"version":3,"names":["UserService","create","sessionStore","Cookies","apiInstance","ResponseErrorHandler","UserStore","constructor","store","useProfile","state","profile","getMe","getState","update","setPassword","passwordDto","getAvatar","set","get","response","Promise","resolve","setTimeout","setUser","error","status","removeUser","_get$profile","avatar","getMedia","userStore"],"sources":["D:/Mega/Planner/frontend/src/entities/user/store.ts"],"sourcesContent":["import {IProfile, UserPasswordDto, UserService, UserUpdateDto} from \"@entities/user\";\r\nimport {create} from \"zustand\";\r\nimport {sessionStore} from \"@entities/session\";\r\nimport Cookies from \"js-cookie\";\r\nimport {apiInstance, ResponseErrorData, ResponseErrorHandler} from \"@shared/api\";\r\n\r\ninterface UserState {\r\n    profile: IProfile | null;\r\n\r\n    getMe: () => Promise<void>;\r\n    update: (profile: UserUpdateDto) => Promise<void>;\r\n    setPassword: (passwordDto: UserPasswordDto) => Promise<void>;\r\n\r\n    getAvatar: () => string | null;\r\n}\r\n\r\nclass UserStore {\r\n    private readonly store;\r\n\r\n    constructor() {\r\n        this.store = create<UserState>((set, get) => ({\r\n            profile: null,\r\n\r\n            getMe: async () => {\r\n                set({profile: null});\r\n\r\n                try {\r\n                    const response = await UserService.getMe();\r\n                    await new Promise(resolve => setTimeout(resolve, 500));\r\n                    sessionStore.setUser(Cookies.get(\"sessionid\")!);\r\n                    set({profile: response});\r\n                }\r\n                catch (error: any) {\r\n                    if(error?.status === 401) {\r\n                        sessionStore.removeUser();\r\n                    }\r\n                }\r\n            },\r\n\r\n            update: async (profile: UserUpdateDto) => {\r\n                try {\r\n                    const response = await UserService.update(profile);\r\n\r\n                    set({profile: response});\r\n                }\r\n                catch (error: any) {\r\n                    throw new ResponseErrorHandler(error as ResponseErrorData);\r\n                }\r\n            },\r\n\r\n            setPassword: async(passwordDto: UserPasswordDto) => {\r\n                try {\r\n                    await UserService.setPassword(passwordDto);\r\n                    sessionStore.removeUser();\r\n                }\r\n                catch (error: any) {\r\n                    throw new ResponseErrorHandler(error as ResponseErrorData);\r\n                }\r\n            },\r\n\r\n            getAvatar: () => {\r\n                if(!get().profile?.avatar) {\r\n                    return null;\r\n                }\r\n\r\n                return apiInstance.getMedia(get().profile!.avatar!);\r\n            }\r\n        }));\r\n    }\r\n\r\n    useProfile = () => this.store(state => state.profile);\r\n\r\n    getMe = () => this.store.getState().getMe();\r\n    update = (profile: UserUpdateDto) => this.store.getState().update(profile);\r\n    setPassword = (passwordDto: UserPasswordDto) => this.store.getState().setPassword(passwordDto);\r\n\r\n    getAvatar = () => this.store.getState().getAvatar();\r\n}\r\n\r\nexport const userStore = new UserStore();"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}