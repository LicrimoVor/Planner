{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport { ResponseErrorHandler } from \"@shared/api\";\nexport function useForm(props) {\n  _s();\n  const {\n    fields,\n    apiCall,\n    onSuccess,\n    onFailure,\n    defaultError\n  } = props;\n  const [isSending, setIsSending] = useState(false);\n  const [sendingError, setSendingError] = useState(defaultError);\n  const handleFormSubmit = async event => {\n    event.preventDefault();\n    const errors = await Promise.all(fields.map(field => field.hasError()));\n    const isFormValid = errors.every(error => !error);\n    if (!isFormValid) return;\n    setIsSending(true);\n    setSendingError(defaultError);\n    try {\n      const response = await apiCall();\n      onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(response);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : error instanceof ResponseErrorHandler ? error.data : \"Произошла ошибка при выполнении запроса\";\n      if (error instanceof ResponseErrorHandler) {\n        fields.forEach(field => {\n          field.setFieldError(message[field.id] || null);\n        });\n      }\n      setSendingError(message);\n      onFailure === null || onFailure === void 0 ? void 0 : onFailure(message);\n    } finally {\n      setIsSending(false);\n    }\n  };\n  const hasFieldErrors = fields.some(field => !!field.error);\n  return {\n    isSending,\n    sendingError,\n    hasFieldErrors,\n    handleFormSubmit\n  };\n}\n_s(useForm, \"o5nq4KOHJWl3AJCaaZbt21Wu1JI=\");\n;","map":{"version":3,"names":["useState","ResponseErrorHandler","useForm","props","_s","fields","apiCall","onSuccess","onFailure","defaultError","isSending","setIsSending","sendingError","setSendingError","handleFormSubmit","event","preventDefault","errors","Promise","all","map","field","hasError","isFormValid","every","error","response","message","Error","data","forEach","setFieldError","id","hasFieldErrors","some"],"sources":["D:/Mega/Planner/frontend/src/shared/hooks/form/use-form.ts"],"sourcesContent":["import {DefaultField} from \"@shared/types\";\r\nimport {FormEventHandler, useState} from \"react\";\r\nimport {ResponseErrorHandler, ResponseErrorData} from \"@shared/api\";\r\n\r\nexport function useForm<Field extends DefaultField, Response, ResponseError>(props: {\r\n    fields: Field[];\r\n    apiCall: () => Promise<Response>;\r\n    onSuccess?: (response: Response) => void;\r\n    onFailure?: (error: ResponseError) => void;\r\n    defaultError: ResponseError;\r\n}): {\r\n    isSending: boolean;\r\n    sendingError: ResponseError;\r\n    hasFieldErrors: boolean;\r\n    handleFormSubmit: FormEventHandler<HTMLFormElement>;\r\n} {\r\n    const {fields, apiCall, onSuccess, onFailure, defaultError} = props;\r\n\r\n    const [isSending, setIsSending] = useState(false);\r\n    const [sendingError, setSendingError] = useState<ResponseError>(defaultError);\r\n\r\n    const handleFormSubmit: FormEventHandler<HTMLFormElement> = async (event) => {\r\n        event.preventDefault();\r\n\r\n        const errors = await Promise.all(fields.map(field => field.hasError()));\r\n        const isFormValid = errors.every(error => !error);\r\n\r\n        if(!isFormValid) return;\r\n\r\n        setIsSending(true);\r\n        setSendingError(defaultError);\r\n\r\n        try {\r\n            const response = await apiCall();\r\n            onSuccess?.(response);\r\n        }\r\n        catch (error) {\r\n            const message = (\r\n                error instanceof Error ?\r\n                    error.message :\r\n                error instanceof ResponseErrorHandler ?\r\n                    error.data :\r\n                \"Произошла ошибка при выполнении запроса\"\r\n            ) as ResponseError;\r\n\r\n            if(error instanceof ResponseErrorHandler) {\r\n                fields.forEach(field => {\r\n                    field.setFieldError((message as ResponseErrorData)[field.id] || null);\r\n                });\r\n            }\r\n\r\n            setSendingError(message);\r\n            onFailure?.(message);\r\n        }\r\n        finally {\r\n            setIsSending(false);\r\n        }\r\n    };\r\n\r\n    const hasFieldErrors = fields.some(field => !!field.error);\r\n\r\n    return {\r\n        isSending,\r\n        sendingError,\r\n        hasFieldErrors,\r\n        handleFormSubmit\r\n    };\r\n};"],"mappings":";AACA,SAA0BA,QAAQ,QAAO,OAAO;AAChD,SAAQC,oBAAoB,QAA0B,aAAa;AAEnE,OAAO,SAASC,OAAOA,CAAsDC,KAM5E,EAKC;EAAAC,EAAA;EACE,MAAM;IAACC,MAAM;IAAEC,OAAO;IAAEC,SAAS;IAAEC,SAAS;IAAEC;EAAY,CAAC,GAAGN,KAAK;EAEnE,MAAM,CAACO,SAAS,EAAEC,YAAY,CAAC,GAAGX,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAM,CAACY,YAAY,EAAEC,eAAe,CAAC,GAAGb,QAAQ,CAAgBS,YAAY,CAAC;EAE7E,MAAMK,gBAAmD,GAAG,MAAOC,KAAK,IAAK;IACzEA,KAAK,CAACC,cAAc,CAAC,CAAC;IAEtB,MAAMC,MAAM,GAAG,MAAMC,OAAO,CAACC,GAAG,CAACd,MAAM,CAACe,GAAG,CAACC,KAAK,IAAIA,KAAK,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACvE,MAAMC,WAAW,GAAGN,MAAM,CAACO,KAAK,CAACC,KAAK,IAAI,CAACA,KAAK,CAAC;IAEjD,IAAG,CAACF,WAAW,EAAE;IAEjBZ,YAAY,CAAC,IAAI,CAAC;IAClBE,eAAe,CAACJ,YAAY,CAAC;IAE7B,IAAI;MACA,MAAMiB,QAAQ,GAAG,MAAMpB,OAAO,CAAC,CAAC;MAChCC,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAGmB,QAAQ,CAAC;IACzB,CAAC,CACD,OAAOD,KAAK,EAAE;MACV,MAAME,OAAO,GACTF,KAAK,YAAYG,KAAK,GAClBH,KAAK,CAACE,OAAO,GACjBF,KAAK,YAAYxB,oBAAoB,GACjCwB,KAAK,CAACI,IAAI,GACd,yCACc;MAElB,IAAGJ,KAAK,YAAYxB,oBAAoB,EAAE;QACtCI,MAAM,CAACyB,OAAO,CAACT,KAAK,IAAI;UACpBA,KAAK,CAACU,aAAa,CAAEJ,OAAO,CAAuBN,KAAK,CAACW,EAAE,CAAC,IAAI,IAAI,CAAC;QACzE,CAAC,CAAC;MACN;MAEAnB,eAAe,CAACc,OAAO,CAAC;MACxBnB,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAGmB,OAAO,CAAC;IACxB,CAAC,SACO;MACJhB,YAAY,CAAC,KAAK,CAAC;IACvB;EACJ,CAAC;EAED,MAAMsB,cAAc,GAAG5B,MAAM,CAAC6B,IAAI,CAACb,KAAK,IAAI,CAAC,CAACA,KAAK,CAACI,KAAK,CAAC;EAE1D,OAAO;IACHf,SAAS;IACTE,YAAY;IACZqB,cAAc;IACdnB;EACJ,CAAC;AACL;AAACV,EAAA,CA/DeF,OAAO;AA+DtB"},"metadata":{},"sourceType":"module","externalDependencies":[]}