{"ast":null,"code":"var _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\nimport { create } from \"zustand\";\nimport { API_META } from \"@shared/api\";\nimport { AuthService, UserService, UserStore } from \"@entities/user\";\nimport Cookies from \"js-cookie\";\nimport { useQuery } from \"@tanstack/react-query\";\nconst useAuthStore = create((set, get) => {\n  var _s = $RefreshSig$();\n  return {\n    meta: API_META.INITIAL,\n    isAuth: false,\n    session: null,\n    login: async params => {\n      if (get().meta === API_META.LOADING) {\n        return;\n      }\n      set({\n        meta: API_META.LOADING\n      });\n      try {\n        await AuthService.login(params);\n        const session = Cookies.get(\"sessionid\");\n        set({\n          session: session\n        });\n        set({\n          isAuth: true,\n          meta: API_META.SUCCESS\n        });\n      } catch (error) {\n        set({\n          meta: API_META.ERROR\n        });\n        throw new Error(\"Неверный логин или пароль\");\n      }\n    },\n    logout: async () => {\n      if (get().meta === API_META.LOADING) {\n        return;\n      }\n      set({\n        meta: API_META.LOADING\n      });\n      try {\n        await AuthService.logout();\n        set({\n          session: null\n        });\n        set({\n          isAuth: false,\n          meta: API_META.SUCCESS\n        });\n      } catch (error) {\n        set({\n          meta: API_META.ERROR\n        });\n      }\n    },\n    check: async () => {\n      if (get().meta === API_META.LOADING) {\n        return;\n      }\n      set({\n        meta: API_META.LOADING\n      });\n      if (!Cookies.get(\"sessionid\")) {\n        set({\n          isAuth: false,\n          meta: API_META.ERROR\n        });\n        return;\n      }\n      try {\n        await UserStore.getMe();\n        set({\n          isAuth: true,\n          meta: API_META.SUCCESS\n        });\n      } catch {\n        set({\n          isAuth: false,\n          meta: API_META.ERROR\n        });\n      }\n    },\n    useTest: _s(() => {\n      _s();\n      return useQuery({\n        queryKey: [],\n        queryFn: async () => {\n          console.log(\"call query\");\n          const response = await UserService.getMe();\n          return response;\n        }\n      });\n    }, \"4ZpngI1uv+Uo3WQHEZmTQ5FNM+k=\", false, function () {\n      return [useQuery];\n    })\n  };\n});\nexport class AuthStore {}\nAuthStore.useSession = useAuthStore.getState().session;\nAuthStore.useMeta = _s2(() => {\n  _s2();\n  return useAuthStore(state => state.meta);\n}, \"BSK3XewfuZPixDP8tbzcobpulFc=\", false, function () {\n  return [useAuthStore];\n});\nAuthStore.useAuth = _s3(() => {\n  _s3();\n  return useAuthStore(state => state.isAuth);\n}, \"BSK3XewfuZPixDP8tbzcobpulFc=\", false, function () {\n  return [useAuthStore];\n});\nAuthStore.login = useAuthStore.getState().login;\nAuthStore.logout = useAuthStore.getState().logout;\nAuthStore.check = useAuthStore.getState().check;","map":{"version":3,"names":["create","API_META","AuthService","UserService","UserStore","Cookies","useQuery","useAuthStore","set","get","_s","$RefreshSig$","meta","INITIAL","isAuth","session","login","params","LOADING","SUCCESS","error","ERROR","Error","logout","check","getMe","useTest","queryKey","queryFn","console","log","response","AuthStore","useSession","getState","useMeta","_s2","state","useAuth","_s3"],"sources":["D:/Mega/Planner/frontend/src/entities/user/auth/store.ts"],"sourcesContent":["import {create} from \"zustand\";\r\nimport {API_META} from \"@shared/api\";\r\nimport {AuthService, ILoginParams, UserService, UserStore} from \"@entities/user\";\r\nimport Cookies from \"js-cookie\";\r\nimport {useQuery, UseQueryResult} from \"@tanstack/react-query\";\r\nimport {persist} from \"zustand/middleware\";\r\n\r\ninterface AuthState {\r\n    meta: API_META;\r\n    isAuth: boolean;\r\n\r\n    session: string | null;\r\n    //\r\n    login: (params: ILoginParams) => Promise<void>;\r\n    logout: () => Promise<void>;\r\n    check: () => Promise<void>;\r\n}\r\n\r\nconst useAuthStore = create<AuthState>(\r\n        (set, get) => ({\r\n            meta: API_META.INITIAL,\r\n            isAuth: false,\r\n\r\n            session: null,\r\n\r\n            login: async (params) => {\r\n                if(get().meta === API_META.LOADING) {\r\n                    return;\r\n                }\r\n\r\n                set({meta: API_META.LOADING});\r\n\r\n                try {\r\n                    await AuthService.login(params);\r\n                    const session = Cookies.get(\"sessionid\");\r\n                    set({session: session});\r\n                    set({isAuth: true, meta: API_META.SUCCESS});\r\n                }\r\n                catch (error) {\r\n                    set({meta: API_META.ERROR});\r\n                    throw new Error(\"Неверный логин или пароль\");\r\n                }\r\n            },\r\n\r\n            logout: async () => {\r\n                if(get().meta === API_META.LOADING) {\r\n                    return;\r\n                }\r\n\r\n                set({meta: API_META.LOADING});\r\n\r\n                try {\r\n                    await AuthService.logout();\r\n                    set({session: null});\r\n                    set({isAuth: false, meta: API_META.SUCCESS});\r\n                }\r\n                catch (error) {\r\n                    set({meta: API_META.ERROR});\r\n                }\r\n            },\r\n\r\n            check: async () => {\r\n                if(get().meta === API_META.LOADING) {\r\n                    return;\r\n                }\r\n\r\n                set({meta: API_META.LOADING});\r\n\r\n                if(!Cookies.get(\"sessionid\")) {\r\n                    set({isAuth: false, meta: API_META.ERROR});\r\n                    return;\r\n                }\r\n\r\n                try {\r\n                    await UserStore.getMe();\r\n                    set({isAuth: true, meta: API_META.SUCCESS});\r\n                }\r\n                catch {\r\n                    set({isAuth: false, meta: API_META.ERROR});\r\n                }\r\n            },\r\n\r\n            useTest: () => useQuery({\r\n                queryKey: [],\r\n\r\n                queryFn: async () => {\r\n                    console.log(\"call query\");\r\n                    const response = await UserService.getMe();\r\n\r\n                    return response;\r\n                }\r\n            })\r\n        })\r\n);\r\n\r\nexport class AuthStore {\r\n    static useSession = useAuthStore.getState().session;\r\n    static useMeta = () => useAuthStore(state => state.meta);\r\n    static useAuth = () => useAuthStore(state => state.isAuth);\r\n\r\n    static login = useAuthStore.getState().login;\r\n    static logout = useAuthStore.getState().logout;\r\n    static check = useAuthStore.getState().check;\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}