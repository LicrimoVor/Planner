{"ast":null,"code":"import axios from \"axios\";\nimport Cookies from \"js-cookie\";\nimport { SERVER_URL } from \"@shared/config\";\nimport { sessionStore } from \"@entities/session\";\nclass ApiInstance {\n  constructor() {\n    this.axios = void 0;\n    this.axios = axios.create({\n      withCredentials: true,\n      baseURL: SERVER_URL.API.ROOT(),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      xsrfHeaderName: \"X-CSRFToken\"\n    });\n    this.axios.interceptors.request.use(config => {\n      const method = config.method.toLowerCase();\n      if (method === \"post\" || method === \"patch\" || method === \"delete\") {\n        const token = Cookies.get(\"csrftoken\");\n        if (token) {\n          config.headers.set(config.xsrfHeaderName, token);\n        }\n      }\n      return config;\n    });\n    this.axios.interceptors.response.use(response => {\n      return response;\n    }, error => {\n      var _error$response;\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n        sessionStore.removeUser(); // КОСТЫЛЬ! НЕЛЬЗЯ БИЗНЕС ЛОГИКУ СЮДА ПИХАТЬ\n\n        if (Cookies.get(\"sessionid\")) {\n          Cookies.remove(\"sessionid\");\n        }\n        if (Cookies.get(\"csrftoken\")) {\n          Cookies.remove(\"csrftoken\");\n        }\n      }\n      throw error;\n    });\n  }\n  async get(endpoint, options = {}) {\n    try {\n      const response = await this.axios.get(endpoint, options);\n      return response.data;\n    } catch (error) {\n      var _response, _response2;\n      throw {\n        status: error === null || error === void 0 ? void 0 : (_response = error.response) === null || _response === void 0 ? void 0 : _response.status,\n        data: error === null || error === void 0 ? void 0 : (_response2 = error.response) === null || _response2 === void 0 ? void 0 : _response2.data\n      };\n    }\n  }\n  async post(endpoint, data, options = {}) {\n    try {\n      const response = await this.axios.post(endpoint, data, options);\n      return response.data;\n    } catch (error) {\n      var _response3;\n      throw error === null || error === void 0 ? void 0 : (_response3 = error.response) === null || _response3 === void 0 ? void 0 : _response3.data;\n    }\n  }\n  async patch(endpoint, data, options = {}) {\n    try {\n      const response = await this.axios.patch(endpoint, data, options);\n      return response.data;\n    } catch (error) {\n      var _response4;\n      throw error === null || error === void 0 ? void 0 : (_response4 = error.response) === null || _response4 === void 0 ? void 0 : _response4.data;\n    }\n  }\n  async delete(endpoint, options = {}) {\n    try {\n      const response = await this.axios.delete(endpoint, options);\n      return response.data;\n    } catch (error) {\n      var _response5;\n      throw error === null || error === void 0 ? void 0 : (_response5 = error.response) === null || _response5 === void 0 ? void 0 : _response5.data;\n    }\n  }\n  async redirect(endpoint) {\n    window.location.href = SERVER_URL.API.ROOT() + endpoint;\n  }\n  getMedia(url) {\n    return SERVER_URL.MEDIA.ROOT() + url;\n  }\n}\nexport const apiInstance = new ApiInstance();","map":{"version":3,"names":["axios","Cookies","SERVER_URL","sessionStore","ApiInstance","constructor","create","withCredentials","baseURL","API","ROOT","headers","xsrfHeaderName","interceptors","request","use","config","method","toLowerCase","token","get","set","response","error","_error$response","status","removeUser","remove","endpoint","options","data","_response","_response2","post","_response3","patch","_response4","delete","_response5","redirect","window","location","href","getMedia","url","MEDIA","apiInstance"],"sources":["D:/Mega/Planner/frontend/src/shared/api/base.ts"],"sourcesContent":["import axios, {\r\n    AxiosError,\r\n    AxiosInstance,\r\n    AxiosRequestConfig,\r\n    AxiosResponse, InternalAxiosRequestConfig,\r\n} from \"axios\";\r\nimport Cookies from \"js-cookie\";\r\nimport {SERVER_URL} from \"@shared/config\";\r\nimport {sessionStore} from \"@entities/session\";\r\n\r\nclass ApiInstance {\r\n    private axios: AxiosInstance;\r\n\r\n    constructor() {\r\n        this.axios = axios.create({\r\n            withCredentials: true,\r\n            baseURL: SERVER_URL.API.ROOT(),\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n            },\r\n            xsrfHeaderName: \"X-CSRFToken\"\r\n        });\r\n\r\n        this.axios.interceptors.request.use((config: InternalAxiosRequestConfig) => {\r\n            const method = config.method!.toLowerCase();\r\n            if(method === \"post\" || method === \"patch\" || method === \"delete\") {\r\n                const token = Cookies.get(\"csrftoken\");\r\n                if(token) {\r\n                    config.headers.set(config.xsrfHeaderName, token);\r\n                }\r\n            }\r\n\r\n            return config;\r\n        });\r\n\r\n        this.axios.interceptors.response.use((response: AxiosResponse) => {\r\n            return response;\r\n        }, (error: AxiosError) => {\r\n            if(error.response?.status === 401) {\r\n                sessionStore.removeUser(); // КОСТЫЛЬ! НЕЛЬЗЯ БИЗНЕС ЛОГИКУ СЮДА ПИХАТЬ\r\n\r\n                if(Cookies.get(\"sessionid\")) {\r\n                    Cookies.remove(\"sessionid\");\r\n                }\r\n                if(Cookies.get(\"csrftoken\")) {\r\n                    Cookies.remove(\"csrftoken\");\r\n                }\r\n            }\r\n\r\n            throw error;\r\n        });\r\n    }\r\n\r\n    async get<T>(endpoint: string, options: AxiosRequestConfig = {}): Promise<T> {\r\n        try {\r\n            const response: AxiosResponse<T> = await this.axios.get(\r\n                endpoint,\r\n                options\r\n            );\r\n            return response.data;\r\n        }\r\n        catch (error) {\r\n            throw {\r\n                status: (error as AxiosError)?.response?.status,\r\n                data: (error as AxiosError)?.response?.data\r\n            };\r\n        }\r\n    }\r\n\r\n    async post<T>(endpoint: string, data: any, options: AxiosRequestConfig = {}): Promise<T> {\r\n        try {\r\n            const response: AxiosResponse<T> = await this.axios.post(\r\n                endpoint,\r\n                data,\r\n                options\r\n            );\r\n\r\n            return response.data;\r\n        }\r\n        catch (error) {\r\n            throw (error as AxiosError)?.response?.data;\r\n        }\r\n    }\r\n\r\n    async patch<T>(endpoint: string, data: any, options: AxiosRequestConfig = {}): Promise<T> {\r\n        try {\r\n            const response: AxiosResponse<T> = await this.axios.patch(\r\n                endpoint,\r\n                data,\r\n                options\r\n            );\r\n            return response.data;\r\n        }\r\n        catch (error) {\r\n            throw (error as AxiosError)?.response?.data;\r\n        }\r\n    }\r\n\r\n    async delete<T>(endpoint: string, options: AxiosRequestConfig = {}): Promise<T> {\r\n        try {\r\n            const response: AxiosResponse<T> = await this.axios.delete(\r\n                endpoint,\r\n                options\r\n            );\r\n            return response.data;\r\n        }\r\n        catch (error) {\r\n            throw (error as AxiosError)?.response?.data;\r\n        }\r\n    }\r\n\r\n    async redirect(endpoint: string): Promise<void> {\r\n        window.location.href = SERVER_URL.API.ROOT() + endpoint;\r\n    }\r\n\r\n    getMedia(url: string): string {\r\n        return SERVER_URL.MEDIA.ROOT() + url;\r\n    }\r\n}\r\n\r\nexport const apiInstance = new ApiInstance();"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}