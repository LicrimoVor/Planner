{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from \"react\";\nimport { ResponseError } from \"@shared/api\";\nexport function useForm(props) {\n  _s();\n  const {\n    fields,\n    apiCall,\n    onSuccess,\n    onFailure\n  } = props;\n  const [isSending, setIsSending] = useState(false);\n  const [sendingError, setSendingError] = useState(null);\n  const handleFormSubmit = async event => {\n    event.preventDefault();\n    const errors = await Promise.all(fields.map(field => field.hasError()));\n    const isFormValid = errors.every(error => !error);\n    if (!isFormValid) return;\n    setIsSending(true);\n    setSendingError(\"\");\n    try {\n      const response = await apiCall();\n      onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(response);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : error instanceof ResponseError ? error.data : \"Произошла ошибка при выполнении запроса\";\n      setSendingError(message);\n      onFailure === null || onFailure === void 0 ? void 0 : onFailure(message);\n    } finally {\n      setIsSending(false);\n    }\n  };\n  const hasFieldErrors = fields.some(field => !!field.error);\n  return {\n    isSending,\n    sendingError,\n    hasFieldErrors,\n    handleFormSubmit\n  };\n}\n_s(useForm, \"4qr5zuZoI45xH2iJHBkAxBfbO6M=\");\n;","map":{"version":3,"names":["useState","ResponseError","useForm","props","_s","fields","apiCall","onSuccess","onFailure","isSending","setIsSending","sendingError","setSendingError","handleFormSubmit","event","preventDefault","errors","Promise","all","map","field","hasError","isFormValid","every","error","response","message","Error","data","hasFieldErrors","some"],"sources":["D:/Mega/Planner/frontend/src/shared/hooks/form/use-form.ts"],"sourcesContent":["import {DefaultField} from \"@shared/types\";\r\nimport {FormEventHandler, useState} from \"react\";\r\nimport {ResponseError, ResponseErrorData} from \"@shared/api\";\r\n\r\nexport function useForm<Field extends DefaultField, Response, ResponseError>(props: {\r\n    fields: Field[];\r\n    apiCall: () => Promise<Response>;\r\n    onSuccess?: (response: Response) => void;\r\n    onFailure?: (error: ResponseError) => void;\r\n}): {\r\n    isSending: boolean;\r\n    sendingError: ResponseError;\r\n    hasFieldErrors: boolean;\r\n    handleFormSubmit: FormEventHandler<HTMLFormElement>;\r\n} {\r\n    const {fields, apiCall, onSuccess, onFailure} = props;\r\n\r\n    const [isSending, setIsSending] = useState(false);\r\n    const [sendingError, setSendingError] = useState<ResponseError>(null);\r\n\r\n    const handleFormSubmit: FormEventHandler<HTMLFormElement> = async (event) => {\r\n        event.preventDefault();\r\n\r\n        const errors = await Promise.all(fields.map(field => field.hasError()));\r\n        const isFormValid = errors.every(error => !error);\r\n\r\n        if(!isFormValid) return;\r\n\r\n        setIsSending(true);\r\n        setSendingError(\"\");\r\n\r\n        try {\r\n            const response = await apiCall();\r\n            onSuccess?.(response);\r\n        }\r\n        catch (error) {\r\n            const message = (\r\n                error instanceof Error ?\r\n                    error.message :\r\n                error instanceof ResponseError ?\r\n                    error.data :\r\n                    \"Произошла ошибка при выполнении запроса\"\r\n            );\r\n\r\n            setSendingError(message);\r\n            onFailure?.(message);\r\n        }\r\n        finally {\r\n            setIsSending(false);\r\n        }\r\n    };\r\n\r\n    const hasFieldErrors = fields.some(field => !!field.error);\r\n\r\n    return {\r\n        isSending,\r\n        sendingError,\r\n        hasFieldErrors,\r\n        handleFormSubmit\r\n    };\r\n};"],"mappings":";AACA,SAA0BA,QAAQ,QAAO,OAAO;AAChD,SAAQC,aAAa,QAA0B,aAAa;AAE5D,OAAO,SAASC,OAAOA,CAAsDC,KAK5E,EAKC;EAAAC,EAAA;EACE,MAAM;IAACC,MAAM;IAAEC,OAAO;IAAEC,SAAS;IAAEC;EAAS,CAAC,GAAGL,KAAK;EAErD,MAAM,CAACM,SAAS,EAAEC,YAAY,CAAC,GAAGV,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAM,CAACW,YAAY,EAAEC,eAAe,CAAC,GAAGZ,QAAQ,CAAgB,IAAI,CAAC;EAErE,MAAMa,gBAAmD,GAAG,MAAOC,KAAK,IAAK;IACzEA,KAAK,CAACC,cAAc,CAAC,CAAC;IAEtB,MAAMC,MAAM,GAAG,MAAMC,OAAO,CAACC,GAAG,CAACb,MAAM,CAACc,GAAG,CAACC,KAAK,IAAIA,KAAK,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACvE,MAAMC,WAAW,GAAGN,MAAM,CAACO,KAAK,CAACC,KAAK,IAAI,CAACA,KAAK,CAAC;IAEjD,IAAG,CAACF,WAAW,EAAE;IAEjBZ,YAAY,CAAC,IAAI,CAAC;IAClBE,eAAe,CAAC,EAAE,CAAC;IAEnB,IAAI;MACA,MAAMa,QAAQ,GAAG,MAAMnB,OAAO,CAAC,CAAC;MAChCC,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAGkB,QAAQ,CAAC;IACzB,CAAC,CACD,OAAOD,KAAK,EAAE;MACV,MAAME,OAAO,GACTF,KAAK,YAAYG,KAAK,GAClBH,KAAK,CAACE,OAAO,GACjBF,KAAK,YAAYvB,aAAa,GAC1BuB,KAAK,CAACI,IAAI,GACV,yCACP;MAEDhB,eAAe,CAACc,OAAO,CAAC;MACxBlB,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAGkB,OAAO,CAAC;IACxB,CAAC,SACO;MACJhB,YAAY,CAAC,KAAK,CAAC;IACvB;EACJ,CAAC;EAED,MAAMmB,cAAc,GAAGxB,MAAM,CAACyB,IAAI,CAACV,KAAK,IAAI,CAAC,CAACA,KAAK,CAACI,KAAK,CAAC;EAE1D,OAAO;IACHf,SAAS;IACTE,YAAY;IACZkB,cAAc;IACdhB;EACJ,CAAC;AACL;AAACT,EAAA,CAxDeF,OAAO;AAwDtB"},"metadata":{},"sourceType":"module","externalDependencies":[]}